<!DOCTYPE html>
<html>
<body>

<h3>Simple PostMessage PoC</h3>
<div id="log"></div>

<script>
    const log = (msg) => {
        const div = document.createElement("div");
        div.textContent = msg;
        document.getElementById("log").appendChild(div);
    };


    window.addEventListener("message", (event) => {
        if (!event.ports || event.ports.length === 0) return;

        const port = event.ports[0];
        log("Port received from app");

    
        port.onmessage = (e) => {
            log(" From App: " + e.data);
        };

      
        port.postMessage(JSON.stringify({ message: "init_complete" }));
        log("Sent: init_complete");

       
        setTimeout(() => {
            port.postMessage(JSON.stringify({ message: "success" }));
            log("Sent: success");
        }, 3000);
    });
</script>

</body>
</html>
